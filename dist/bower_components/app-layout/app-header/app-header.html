<link rel="import" href="../../polymer/polymer.html"><link rel="import" href="../../iron-flex-layout/iron-flex-layout.html"><link rel="import" href="../app-scroll-effects/app-scroll-effects-behavior.html"><dom-module id="app-header"><style>:host{position:relative;display:block;-webkit-transform:translateZ(0)}:host>::content>app-toolbar:first-of-type{-webkit-transform:translateZ(0)}:host::after{content:"";position:absolute;left:0;right:0;bottom:-5px;width:100%;height:5px;pointer-events:none;opacity:0;box-shadow:inset 0 5px 6px -3px rgba(0,0,0,.4);will-change:opacity;-webkit-transition:opacity .4s;transition:opacity .4s;-webkit-transform:translateZ(0);@apply(--app-header-shadow)}:host([shadow])::after{opacity:1}:host>::content [condensed-title]{opacity:0;white-space:nowrap;-webkit-transform-origin:left top;transform-origin:left top}:host>::content [title]{white-space:nowrap;-webkit-transform-origin:left top;transform-origin:left top}#clip{@apply(--layout-fit);overflow:hidden}#backLayer,#frontLayer{@apply(--layout-fit);pointer-events:none;background-size:cover;height:100%}#frontLayer{@apply(--app-header-front-background)}#backLayer{@apply(--app-header-back-background);opacity:0}#contentContainer{position:relative;height:100%;width:100%}:host([no-transitions]),:host([no-transitions]) #backLayer,:host([no-transitions]) #frontLayer,:host([no-transitions])::after,:host([no-transitions])>::content>app-toolbar:first-of-type{transition:none!important}</style><template><div id="clip"><div id="backLayer"></div><div id="frontLayer"></div></div><div id="contentContainer"><content id="content"></content></div></template><script>Polymer({is:"app-header",behaviors:[Polymer.AppScrollEffectsBehavior],properties:{condenses:{type:Boolean,value:!1},fixed:{type:Boolean,value:!1},reveals:{type:Boolean,value:!1},shadow:{type:Boolean,reflectToAttribute:!0,value:!1}},behaviors:[Polymer.AppScrollEffectsBehavior],observers:["_condensesChanged(condenses, isAttached)"],_height:0,_deltaHeight:0,_topbar:null,_top:0,_progress:0,_lastScrollTop:0,get _headerDy(){return this.fixed?this._deltaHeight:this._height+5},created:function(){this._top=0},setup:function(){if(0!==this.offsetWidth||0!==this.offsetHeight){var t=0===this._height,e=this._clampedScrollTop,s=this.noTransitions;this._height=this.offsetHeight,this._topbar=Polymer.dom(this).querySelector("app-toolbar"),this.noTransitions=!0,t||0===e?(this.cancelDebouncer("_resize"),this._deltaHeight=this._topbar?this._height-this._topbar.offsetHeight:0,this._setUpEffect(),this._updateScrollState(e,!0)):(this._updateScrollState(0,!0),this._deltaHeight=this._topbar?this._height-this._topbar.offsetHeight:0,this._setUpEffect(),this._updateScrollState(this._lastScrollTop,!0),this._layoutIfDirty()),this.noTransitions=s}},_updateScrollState:function(t,e){if(0!==this._height){var s,i=!this.fixed||this.condenses,h=Math.min(this._headerDy,Math.max(0,this.reveals?this._top+t-this._lastScrollTop:t));this._shouldCondense(t)&&(h=Math.max(this._deltaHeight,h)),s=0===this._deltaHeight?t>0?1:0:h/this._deltaHeight,(e||s!==this._progress||h!==this._top||0===t)&&(this._runEffects(s,i?h:0),this._transformHeader(i?h:0),this.fire("app-header-transform",{top:h,progress:s},{bubbles:!1})),e||(this._top=h,this._lastScrollTop=t,this._progress=s)}},_shouldCondense:function(t){return this._lastScrollTop>=t&&t>this._deltaHeight&&(!this.reveals||this.condenses)},isOnScreen:function(){return 0!==this._height&&(0===this._top||this._top<this._height)},isContentBelow:function(){return 0===this._top?this._clampedScrollTop>0:this._clampedScrollTop-this._headerDy>=0},_transformHeader:function(t){this.transform("translate3d(0,"+-t+"px, 0)"),this._topbar&&this.condenses&&this.transform("translate3d(0,"+Math.min(t,this._deltaHeight)+"px, 0)",this._topbar)},_condensesChanged:function(){this.debounce("_setup",this.setup,1)}});</script></dom-module>