<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<!-- <link rel="import" href="..\..\bower_components/polymer/polymer.html"> -->

<dom-module id="semafloor-main">
  <template strip-whitespace>
    <style>
      :host {
        display: block;
      }

      * {
        box-sizing: border-box;;
      }

      app-header-layout app-header {
        color: #009688;
        --app-header-background-front-layer: {
          background-color: #fff;
        };
        --app-header-background-rear-layer: {
          background-color: #009688;
        };
      }
      app-header-layout [shadow],
      [shadow] .title {
        color: #fff;
      }

      .title {
        margin-left: 8px;
      }

      /* anchor tags */
      a {
        text-decoration: none;
        color: inherit;
        font-size: inherit;
      }
      .nav-menu {
        margin-top: 8px;
      }
      .nav-menu > a {
        display: block;
        padding: 12px 16px;
        font-size: 14px;
        /*color: #616161;*/
        font-weight: 500;
        /* According to Google Play Store, the height should be 48px. */
        height: 48px;
        @apply(--layout-horizontal);
        @apply(--layout-center);
      }
      .nav-menu > a.iron-selected {
        font-weight: 400;
        background-color: #eee;
      }
      .nav-menu > a[name=profile] > iron-icon{
        color: #3F51B5;
      }
      .nav-menu > a[name=reserve] > iron-icon{
        color: #795548;
      }
      .nav-menu > a[name=search] > iron-icon{
        color: #FF5722;
      }
      .nav-menu > a[name=current] > iron-icon{
        color: #607D8B;
      }
      .nav-menu > a[name=room] > iron-icon{
        color: #F44336;
      }

      .home {
        padding: 24px 16px 16px;
      }

    </style>

    <app-drawer-layout force-narrow>
      <app-drawer swipe-open>
        <app-header-layout>
          <app-header>
            <template is="dom-if" if="[[!_isLoggedIn]]" restamp="true" strip-whitespace>
              <div class="account-image">
                <!-- <div class="account-pic" id="accountPic"></div> -->
                <iron-image class="account-pic" src$="[[authUser.google.profileImageURL]]" sizing="contain" preload fade></iron-image>
                <div class="account-menu" on-tap="_unAuth">
                  <div class="account-name">[[authUser.google.displayName]]</div>
                  <div class="account-email">[[authUser.google.email]]</div>
                </div>
              </div>
            </template>
            <template is="dom-if" if="[[_isLoggedIn]]" restamp="true" strip-whitespace>
              <div class="account-need-login" on-tap="_authWithGoogle">
                Sign in
              </div>
            </template>
          </app-header>

          <iron-selector class="nav-menu" selected="[[category]]" attr-for-selected="name" on-tap="_closeDrawer">
            <a href="/home/view" name="home">Home</a>
            <a href="/profile/view" name="profile" hidden$="[[_isLoggedIn]]">My Profile</a>
            <a href="/reserve/view" name="reserve" hidden$="[[_isLoggedIn]]">My Reservations</a>
            <a href="/search/view" name="search" hidden$="[[_isLoggedIn]]">Search &amp; Reserve</a>
            <a href="/current/view" name="current">Current Reservations</a>
            <a href="/room/view" name="room">Room Information</a>
            <!-- <a href="/settings" name="settings"></a> -->
          </iron-selector>
        </app-header-layout>
      </app-drawer>

      <app-header-layout>
        <app-header fixed condenses reveals effects="material fade-background">
          <app-toolbar>
            <paper-icon-button icon="icons:menu" drawer-toggle></paper-icon-button>
            <span class="title">[[pageTitle]]</span>
          </app-toolbar>
        </app-header>

        <iron-pages selected="[[page]]" attr-for-selected="page">
          <div class="home" page="home">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quibusdam, minima!
          </div>

          <template is="dom-if" if="[[_isCurrentPageOpened]]" restamp="true" strip-whitespace>
            <semafloor-current-page page="current" uid="[[uid]]" on-current-page-attached="_onPageAttached"></semafloor-current-page>
          </template>
          <template is="dom-if" if="[[_isRoomPageOpened]]" restamp="true" strip-whitespace>
            <semafloor-room-page page="room" uid=[[uid]] on-room-page-attached="_onPageAttached"></semafloor-room-page>
          </template>
        </iron-pages>
      </app-header-layout>
    </app-drawer-layout>
  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'semafloor-main',

      _pageCodes: ['home', 'profile', 'reserve', 'search', 'current', 'room'],
      _pageNames: ['Home', 'My Profile', 'My Reservations', 'Search & Reserve',
        'Current Reservations', 'Room Information'],

      properties: {
        category: String,
        page: String,
        uid: String,
        pageTitle: String,

        _isRoomPageOpened: Boolean,
        _isRoomPageAttached: Boolean,

        _isLoggedIn: {
          type: Boolean,
          value: !0
        },

      },

      observers: [
        '_computePageTitle(category)'
      ],

      ready: function() {
        this.fire('upgraded');
        this.set('upgraded', !0);
      },
      attached: function() {
        this.fire('main-page-attached');
      },

      _computePageTitle: function(_category) {
        console.time('_computePageTitle');
        var _isPageOpened = '_is' + _.capitalize(_category) + 'PageOpened';
        var _pageIdx = this._pageCodes.indexOf(_category);
        var _pageTitle = this._pageNames[_pageIdx];
        if (!this[_isPageOpened]) {
          this.set(_isPageOpened, !0);
        }

        this.set('pageTitle', _pageTitle);

        console.timeEnd('_computePageTitle');
        console.log(_category);
      },

      _onPageAttached: function(ev) {
        console.time('_onPageAttached');
        var _isPageAttached = '_' + _.camelCase('is ' + ev.type);
        if (!this[_isPageAttached]) {
          this.set(_isPageAttached, !0);
        }
        console.timeEnd('_onPageAttached');
        console.log(ev);
      },

      _closeDrawer: function() {
        console.time('_closeDrawer');
        var _drawer = Polymer.dom(this.root).querySelector('app-drawer');
        _drawer.close();
        console.timeEnd('_closeDrawer');
      },

    });
  })();
  </script>
</dom-module>
