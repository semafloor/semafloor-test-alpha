<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../semafloor-room/semafloor-room.html">
<link rel="import" href="../../bower_components/semafloor-icons/semafloor-icons.html">

<link rel="import" href="../../bower_components/semafloor-profile-page/semafloor-profile-page.html">
<link rel="import" href="../../bower_components/semafloor-reserve-page/semafloor-reserve-page.html">
<link rel="import" href="../../bower_components/semafloor-search-page/semafloor-search-page.html">
<link rel="import" href="../../bower_components/semafloor-current-page/semafloor-current-page.html">
<!-- <link rel="import" href="../../bower_components/semafloor-room-page/semafloor-room-page.html"> -->

<link rel="import" href="../../bower_components/app-layout/app-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">

<link rel="import" href="../../bower_components/iron-page-url/iron-page-url.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html">

<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">

<link rel="import" href="../../bower_components/firebase-element/firebase-auth.html">

<link rel="import" href="../../bower_components/jv-datepicker/datepicker-slide-from-bottom-animation.html">
<link rel="import" href="../../bower_components/jv-datepicker/datepicker-slide-from-top-animation.html">
<link rel="import" href="../lodash.html">

<dom-module id="semafloor-main">
  <template strip-whitespace>
    <style>
      :host {
        display: block;

        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
      }

      * {
        box-sizing: border-box;
      }

      /*iron-pages {
        height: 9999px;
      }*/
      app-header {
        color: #1ddbd8;
        --app-header-background-front-layer:`` {
          background-color: #fff;
        };
        --app-header-background-rear-layer: {
          background-color: #009688;
        };
        --app-header-shadow: {
          box-shadow: inset 0px 5px 6px -3px rgba(0, 0, 0, 0.2);
          height: 10px;
          bottom: -10px;
        };
      }
      app-header:not([shadow]) {
        border-bottom: 1px solid #ddd;
      }
      app-header[shadow] {
        color: #fff;
      }
      app-header[shadow] #tabs,
      app-header[shadow] #tabs ::content #selectionBar,
      app-header[shadow] #tabs paper-tab ::content paper-ripple,
      app-header[shadow] #tabs paper-tab a {
        color: #ffff00;
      }
      app-header[shadow] #tabs ::content #selectionBar{
        background-color: #ffff00;
        /*--paper-tabs-selection-bar-color: #ffff00;*/
      }
      app-header[shadow] #tabs paper-tab ::content paper-ripple {
        color: #ffff00;
        /*--paper-tab-ink: #ffff00;*/
      }

      .title {
        margin: 0 auto 0 36px;
        font-size: 20px;
      }

      .main-toolbar {
        height: 110px;
      }
      /*.reserve-toolbar {
        background-color: #fff;
      }*/

      #tabs {
        /*margin-left: -55px;*/
        color: #1ddbd8;
        font-size: 13px;
        --paper-tabs-selection-bar-color: #1ddbd8;
      }
      #tabs paper-tab {
        @apply(--layout-flex-none);
        padding: 0;
        --paper-tab-ink: #1ddbd8;
      }
      #tabs paper-tab a {
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
        text-decoration: none;
        text-transform: uppercase;
        color: #7c7c7c;
        font-weight: 500;
        padding: 0 20px;
        height: 100%;
      }
      .big-reserve-tabs {
        height: 64px;
        background-color: #fff;
      }

      app-drawer {
        --app-drawer-content-container: {
          background-color: #fafafa;
        };
      }

      .account-image {
        position: relative;
        height: 144px;
        padding: 0 16px;
        background-image: url(//lh3.googleusercontent.com/-S0NlQSizDuM/VSHcZNxiJqI/AAAAAAAAIio/MfI3_-S54B8/w640-h361-n-no/20150402_192344.jpg);
        background-blend-mode: overlay;
        background-repeat: no-repeat;
        background-size: cover;
        background-color: #555;
      }
      .account-pic {
        position: absolute;
        height: 64px;
        width: 64px;
        border-radius: 50%;
        background-color: #7c7c7c;
        top: 16px;
        --iron-image-placeholder: {
          border-radius: 50%;
        };
      }
      .account-menu {
        position: absolute;
        bottom: 16px;
        color: #fff;
        cursor: pointer;
        font-size: 12px;
        font-weight: 300;
      }
      .account-name {
        font-weight: 500;
        line-height: 16px;
      }
      .account-sign-in {
        padding-left: 16px;
        /*background-color: #007968;*/
        background-color: #1ddb8b;
        color: #444;
        cursor: pointer;
        height: 48px;
        font-size: 20px;
        @apply(--layout-horizontal);
        @apply(--layout-center);
      }

      .toolbar-account {
        cursor: pointer;
        font-size: 10px;
        margin-right: 8px;
        text-align: right;
        @apply(--layout-vertical);
      }
      .toolbar-account-pic {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background-color: #7c7c7c;
        --iron-image-placeholder: {
          border-radius: 50%;
        };
      }
      /* workaround: iron-image unable to be styled round under dom-if */
      .toolbar-account-pic > ::content > * {
        border-radius: 50%;
      }
      .toolbar-account-sign-in {
        cursor: pointer;
        font-size: 16px;
        margin-right: 16px;
      }

      /* anchor tags */
      a {
        text-decoration: none;
        color: inherit;
        font-size: inherit;
      }
      .nav-menu {
        margin-top: 8px;
      }
      .nav-menu > a {
        display: block;
        padding: 12px 16px;
        font-size: 14px;
        font-weight: 500;
        height: 48px;
        @apply(--layout-horizontal);
        @apply(--layout-center);
      }
      .nav-menu a.active {
        background-color: #eee;
        color: #7c7c7c;
        font-weight: 400;
      }

      .home {
        padding: 24px 16px 16px;
      }

      app-toolbar > [icon] {
        display: none;
      }

      semafloor-search-page {
        /* Strange issue: will-change on opacity will break iron-overlay-manager? */
        /*will-change: opacity;*/
        opacity: 1;
        transition: opacity ease-in .4s;
      }
      semafloor-search-page.animate-reserve {
        opacity: 0;
      }

      /* small desktop & tablet */
      @media all and (max-width: 1200px) {
        .main-toolbar {
          height: 64px;
        }
      }

      /* Mobile */
      /*@media all and (max-width: 400px) {*/
      @media all and (max-width: 599px) {
        app-toolbar > [icon] {
          display: block;
        }

        .title {
          margin: 0 auto;
        }

        .main-toolbar {
          height: 64px;
        }

        .reserve-tabs {
          position: absolute;
          bottom: 0;
          left: 0;
          right: 0;
          height: 100%;
          --paper-tabs-selection-bar-color: #1ddbd8;
        }
        .reserve-tabs paper-tab {
          text-transform: uppercase;
          --paper-tab-ink: #1ddbd8;
        }
      }
    </style>

    <iron-page-url hash="{{urlHash}}" path="{{path}}"></iron-page-url>
    <!-- <iron-media-query query="max-width: 400px" query-matches="{{smallScreen}}"></iron-media-query> -->
    <iron-media-query query="max-width: 599px" query-matches="{{smallScreen}}"></iron-media-query>

    <firebase-auth id="semafloorAuth"
      location="[[authURL]]"
      provider="[[authProvider]]"
      redirect="[[authRedirect]]"
      status-known="{{authStatus}}"
      user="{{authUser}}"
      on-login="_onLogin"
      on-logout="_onLogout"
      on-error="_onError"
      params='{"scope": "email"}'></firebase-auth>

    <app-drawer-layout force-narrow>
      <app-drawer id="drawer" swipe-open="[[smallScreen]]" on-app-drawer-overlay-changed="_onDrawerClosed">
        <template is="dom-if" if="[[smallScreen]]" restamp="true" strip-whitespace>
          <template is="dom-if" if="[[_computeLoggedIn(authStatus, authUser)]]" restamp="true" strip-whitespace>
            <div class="account-image">
              <iron-image class="account-pic" src$="[[authUser.google.profileImageURL]]" preload sizing="contain" fade></iron-image>
              <div class="account-menu" on-tap="_logout">
                <div class="account-name"> [[authUser.google.displayName]] </div>
                <div class="account-email"> [[authUser.google.email]] </div>
              </div>
            </div>
          </template>

          <template is="dom-if" if="[[!_computeLoggedIn(authStatus, authUser)]]" restamp="true" strip-whitespace>
            <div class="account-sign-in" on-tap="_loginWithGoogle"> Sign in </div>
          </template>

          <div class="nav-menu">
            <template is="dom-repeat" items="[[_categories]]" index-as="index" strip-whitespace>
              <a href="#[[item]]/view" class$="[[_computeCategoryCls(item, category)]]"> [[_computeCategoryName(index, item)]] </a>
            </template>
          </div>
        </template>
      </app-drawer>

      <app-header-layout>
        <app-header id="header" fixed="[[!smallScreen]]" condenses="[[smallScreen]]" reveals="[[smallScreen]]" effects="waterfall blend-background fade-background">
          <app-toolbar class="main-toolbar">
            <paper-icon-button icon="icons:menu" drawer-toggle></paper-icon-button>
            <span condensed-title hidden></span>
            <span title hidden></span>
            <span class="title">[[pageTitle]]</span>

            <template is="dom-if" if="[[!smallScreen]]" restamp="true" strip-whitespace>
              <template is="dom-if" if="[[authUser]]" restamp="true" strip-whitespace>
                <div class="toolbar-account" on-tap="_logout">
                  <div class="toolbar-account-name"> [[authUser.google.displayName]] </div>
                  <div class="toolbar-account-email"> [[authUser.google.email]] </div>
                </div>
                <iron-image class="toolbar-account-pic" src$="[[authUser.google.profileImageURL]]" preload sizing="contain" fade></iron-image>
              </template>
              <template is="dom-if" if="[[!authUser]]" restamp="true" strip-whitespace>
                <div class="toolbar-account-sign-in" on-tap="_loginWithGoogle">
                  Sign in
                </div>
              </template>
            </template>
          </app-toolbar>

          <!-- <template is="dom-if" if="[[_shouldShowTabs(smallScreen)]]" restamp="true" strip-whitespace> -->
          <template is="dom-if" if="[[!smallScreen]]" restamp="true" strip-whitespace>
            <!-- <paper-tabs id="tabs" selected="{{category}}" scrollable primary$="[[_shouldShowTabs(smallScreen)]]" attr-for-selected="tab"> -->
            <paper-tabs id="tabs" selected="{{category}}" scrollable primary$="[[smallScreen]]" attr-for-selected="tab">
              <template is="dom-repeat" items="[[_categories]]" index-as="index" strip-whitespace>
                <paper-tab tab="[[item]]">
                  <a href="#[[item]]/view"> [[_computeCategoryName(index, item)]] </a>
                </paper-tab>
              </template>
            </paper-tabs>
          </template>
        </app-header>

        <iron-pages selected="[[category]]" attr-for-selected="page">
          <div class="home" page="home">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quibusdam, minima!
          </div>

          <template is="dom-if" if="[[_isProfilePageOpened]]" restamp="true" strip-whitespace>
            <semafloor-profile-page page="profile" uid="[[uid]]"
              on-profile-page-attached="_onPageAttached"></semafloor-profile-page>
          </template>
          <template is="dom-if" if="[[_isReservePageOpened]]" restamp="true" strip-whitespace>
            <semafloor-reserve-page id="reservePage" page="reserve" uid="[[uid]]"
              post-y="[[_postY]]"
              on-reserve-page-attached="_onPageAttached"></semafloor-reserve-page>
          </template>
          <template is="dom-if" if="[[_isSearchPageOpened]]" restamp="true" strip-whitespace>
            <semafloor-search-page id="searchPage" page="search" uid="[[uid]]"
            on-search-page-attached="_onPageAttached"></semafloor-search-page>
          </template>
          <template is="dom-if" if="[[_isCurrentPageOpened]]" restamp="true" strip-whitespace>
            <semafloor-current-page page="current"
              on-current-page-attached="_onPageAttached"></semafloor-current-page>
          </template>
          <template is="dom-if" if="[[_isRoomPageOpened]]" restamp="true" strip-whitespace>
            <!-- <semafloor-room-page page="room"
              on-room-page-attached="_onPageAttached"></semafloor-room-page> -->
            <semafloor-room page="room" on-room-page-attached="_onPageAttached"></semafloor-room>
          </template>

        </iron-pages>
      </app-header-layout>

      <paper-toast id="authToast" text="[[authMsg]]"></paper-toast>
    </app-drawer-layout>
  </template>

  <script>
    Polymer({
      is: 'semafloor-main',

      properties: {
        uid: String,
        category: {
          type: String,
          value: 'home'
        },
        pageTitle: {
          type: String,
          value: 'Home'
        },
        urlHash: {
          type: String,
          value: "home/view"
        },
        path: String,
        smallScreen: Boolean,

        authURL: {
          type: String,
          value: '//semafloor-webapp.firebaseio.com'
        },
        authProvider: {
          type: String,
          value: 'google'
        },
        authRedirect: Boolean,
        authStatus: Boolean,
        authUser: Object,
        authMsg: String,

        _isSearchPageOpened: Boolean,
        _categories: {
          type: Array,
          // value: [ 'home', 'profile', 'reserve', 'search', 'current', 'room' ]
          value: [ 'home', 'current', 'room' ]
        },
        _categoryNames: {
          type: Array,
          // value: [
          //   'Home', 'My Profile', 'My Reservations', 'Search & Reserve',
          //   'Current Reservations', 'Room Information'
          // ]
          value: [ 'Home', 'Current Reservations', 'Room Information' ]
        },

        _reserveCategories: {
          type: Array,
          value: [ 'today', 'this week', 'upcoming' ]
        },

        _postY: Number,
        _animateReserve: Boolean,

      },

      observers: [
        '_hashDidChange(urlHash, authUser)',
        '_updateUid(authUser)',
        '_closeDrawerOnLargeScreen(smallScreen)'
      ],

      attached: function() {
        // console.log('*Last - attached: start');
        var _redirectIfMobile = window.navigator.maxTouchPoints > 0 && window.outerWidth < 1367;
        var _header = this.$.header;
        var _thisSet = this.set.bind(this);
        // Breaking change in v0.0.13 of app-layout as app-header-transfrom has been replaced
        // by app-header's getScrollState() method.
        window.addEventListener('scroll', function() {
          var _postY = _header.getScrollState().top;
          _thisSet('_postY', _postY);
        });

        this.set('authRedirect', _redirectIfMobile);

        this.fire('main-page-attached', 'main');
        // console.log('*Last - attached: end');
      },

      _computeLoginCls: function(_authStatus, _authUser) {
        var _isLoggedIn = !_authStatus || !!_authUser;
        // console.log('_computeLoginCls');
        return _isLoggedIn ? 'signed-in' : '';
      },
      _computeCategoryCls: function(_item, _category) {
        // console.log('3 - _computeCategoryCls');
        return _item === _category ? 'active' : '';
      },

      _computeLoggedIn: function(_authStatus, _authUser) {
        // console.log('4 - _computeLoggedIn', _authStatus, !!_authUser);
        return !_authStatus || !!_authUser;
      },
      _computeCategoryName: function(_index, _item) {
        // workaround: dom-repeat seems to like kind of re-using the already
        // generated elements on the page even though the items encountered changes
        // in its value. Hence the 2nd param is to ensure everything will be updated
        // over again once.
        // console.log('2 - _computeCategoryName', _index, _item, this._categoryNames);
        return this._categoryNames[_index];
      },
      // _shouldShowTabs: function(_hashie, _smallScreen) {
      //   console.log('_shouldShowTabs: start');
      //   // this.debounce('_shouldShowTabs', function() {
      //     console.log(this.category);
      //   //   this.set('_forceUpdateHash', !1);
      //   // }, 1);
      //
      //   var _isHashCategoryView = this._isHashCategoryView(_hashie);
      //   console.log('_shouldShowTabs: end');
      //   return _isHashCategoryView[0] && !_smallScreen;
      // },

      _onPageAttached: function(ev) {
        // console.log('_onPageAttached: start');
        var _isPageAttached = '_' + _.camelCase('is ' + ev.type);
        if (this._animateReserve && ev.type.indexOf('search') >= 0) {
          var _searchPage = this.$$('#searchPage');
          var _searchPage = this.$$('#searchPage');
          _searchPage.classList.add('animate-reserve');
          window.location.hash = '#search/view';
        }

        if (!this[_isPageAttached]) {
          this.set(_isPageAttached, !0);
          // console.log('_onPageAttached', ev.type);
        }
        // console.log('_onPageAttached: end');
      },
      _onError: function(ev) {
        // console.log('_onError: ', ev.detail.message);
      },
      _onLogin: function() {
        // console.log('_onLogin: start');
        var _authMsg = 'Logged in';
        var _authToast = this.$.authToast;
        var _authUser = this.authUser;

        _authMsg += !!_authUser ? ' as ' + _authUser.google.displayName + '.' : '!';

        if (_authToast.opened) {
          _authToast.close();
        }

        this.set('authMsg', _authMsg);
        this.async(function() {
          _authToast.open();
          // console.log('_onLogin: end');
        }, 1);
      },
      _onLogout: function() {
        // console.log('_onLogout: start');
        var _authMsg = 'Logged out!';
        var _authToast = this.$.authToast;
        var _urlHash = this.urlHash;

        this._recategorize(!1);
        // Redirect to home if sign out from any page that only will display when signed in.
        if (_urlHash !== 'home' || _urlHash !== 'current' || _urlHash !== 'room') {
          window.location.hash = 'home/view';
        }

        this.debounce('reset path', function() {
          this.set('path', '/');
          console.log('reset path', this.path);
        });

        if (_authToast.opened) {
          _authToast.close();
        }

        this.set('authMsg', _authMsg);
        this.async(function() {
          _authToast.open();
          // console.log('_onLogout: end');
        }, 1);
      },

      _intepretHash: function(_urlHash) {
        // console.log('8 - _intepretHash: start');
        var _capturingGroup = /^([a-z]+)\/([a-z]+)/i.exec(_urlHash);
        // console.log('8 - _intepretHash: end');
        return _capturingGroup;
      },
      _isHashCategoryView: function(_urlHash) {
        // console.log('7 - _isHashCategoryView: start', _urlHash);
        var _capturingGroup = this._intepretHash(_urlHash);
        var _isView = _capturingGroup[2] === 'view';
        var _isCategory = this._categories.indexOf(_capturingGroup[1]) >= 0;

        // console.log('7 - _isHashCategoryView: end');
        return [_isView && _isCategory, _capturingGroup[1]];
      },
      _hashDidChange: function(_urlHash, _authUser) {
        // console.log('5 - _hashDidChange: start', this.category);
        // Simple way to redirect * to home page.
        var _re = /(home|profile|reserve|search|current|room)\/\w+/i;
        var _m = _re.exec(_urlHash);
        // If hash is null and need re-routing to home page...
        // if (!_m && _path) {
        if (!_m) {
          // console.log('haha', _urlHash, _path);
          window.location.hash = 'home/view';
          return;
        }
        // console.log(_urlHash, _path, _authUser);

        // workaround: Close drawer on hash change. For some unknown reason,
        // the drawer is not closed.
        this.debounce('_closeDrawer', function() {
          this.$.drawer.close();
        });

        // Update _categories and _categoryNames with _authUser.
        this._recategorize(!!_authUser);
        // Update pathname to logged in user's username to differentiate between
        // anonymous and logged in user.
        if (!!_authUser && this.path === '/') {
          this.debounce('set username to path', function() {
            console.log('set username to pathname', this.path, _authUser);
            var _profile = _authUser.google.cachedUserProfile;
            var _uname = _.capitalize(_profile.family_name) + _.capitalize(_profile.given_name);
            // this.set('path', _uname);
            window.location.pathname = _uname;
            // GC-ed.
            _profile = null; _uname = null;
          });
        }else if (!!!_authUser && this.path !== '/'){
          window.location.pathname = '/';
          console.log(!!_authUser, this.path);
        }

        // hash is not null...
        var _isHashCategoryView = this._isHashCategoryView(_urlHash);
        var _category = this.category;
        var _categoryFromHash = _isHashCategoryView[1];
        var _isPageOpened = '_is' + _.capitalize(_categoryFromHash) + 'PageOpened';

        // TODO: what to do sequentially?
        // hash
        // _categories
        // _categoryNames
        // changeTitle
        // category

        // Rename page title with hash change right after category value is
        // extracted from the location hash.
        this._rePageTitle(_categoryFromHash);

        // Check if selected page has been rendered since every page is rendered lazily.
        if (!this[_isPageOpened] || !Polymer.isInstance(Polymer.dom(this.root).querySelector('semafloor-' + _categoryFromHash + '-page'))) {
          this.set(_isPageOpened, !0);
        }else {
          // Only run this code when user taps on the paper-fab at reserve page
          // this code will give the search page a special transition.
          if (this._animateReserve && _categoryFromHash === 'search') {
            this.set('_animateReserve', !1);

            this.async(function() {
              this.$$('#searchPage').classList.remove('animate-reserve');
            }, 300);
          }
        }

        // // workaround as needed to resetlayout of app-header when transition from
        // // no hash to URL with hash value.
        // this.$.header._scrollTop = 0;
        // this.$.header.resetLayout();
        // this.$.drawer.close();
        this.async(function() {
          this.set('category', _categoryFromHash);
        }, 1);
        // console.log('5 - _hashDidChange: end', this.category);
      },

      // Update uid.
      _updateUid: function(_authUser) {
        // console.log('8 - _updateUid: start');
        if (!_authUser) {
          // console.log('8 - _updateUid: end');
          return;
        }

        var _ref = this.$.semafloorAuth.ref;
        var _that = this;
        _ref.child('users/' + _authUser.provider).once('value').then(function(snapshot) {
          var _isUser = snapshot.child(_authUser.uid).exists();
          if (_isUser) {
            // Access data directly from the user.		 +
             console.warn('Existing user! Allow profile to read data from the user...');
            _that.set('uid', _authUser.uid);
          }else {
            console.warn('Creating Firebase for new user...');
            _ref.child('users/' + _authUser.provider + '/' + _authUser.uid)
              .transaction(function(data) {
                if (data == null) {
                  var _newUserData = {
                    displayName: _authUser.google.displayName,
                    email: _authUser.google.email,
                    id: _authUser.google.id,
                    profileImageURL: _authUser.google.profileImageURL,
                    provider: _authUser.provider,
                    uid: _authUser.uid,
                    cachedUserProfile: _authUser.google.cachedUserProfile,
                    profile: {
                      username: _authUser.google.displayName,
                      uid: _authUser.google.cachedUserProfile.given_name.slice(0, 1).toLowerCase() +
                        _authUser.google.cachedUserProfile.family_name.slice(0, 1).toLowerCase() +
                        String.fromCharCode(_.random(97, 122)) +
                        String.fromCharCode(_.random(97, 122)) +
                        String.fromCharCode(_.random(97, 122)),
                      group: _.random(99),
                      email: _authUser.google.email,
                      role: _.sample(['normal', 'vip', 'boss', 'janitor', 'elite', 'principal']),
                      room: String.fromCharCode(_.random(65, 90)) +
                        ('000' + _.random(999)).slice(-3),
                        floor: String.fromCharCode(_.random(65, 90)) +
                        ('000' + _.random(999)).slice(-3),
                      tzone: 'GMT +8',
                      tout: 1440
                    },
                    reservations: {
                      createdTime: Firebase.ServerValue.TIMESTAMP
                    }
                  };
                  return _newUserData;
                }else {
                  console.error('User already exists?!');
                  return;
                }
              }).then(function(data) {
                if (!data.committed) {
                  console.warn('Aborted!');
                }else {
                  // console.log(data.snapshot.val());
                }
                // console.log('_updateUid: end');
              }).catch(function(error) {
                console.error(error);
                // console.log('_updateUid: end');
              });
          }
          // console.log('8 - _updateUid: end');
        });
      },

      _loginWithGoogle: function() {
        // console.log('_loginWithGoogle: start');
        if (!!this.authUser) {
          return;
        }

        this.$.semafloorAuth.login();
        // console.log('_loginWithGoogle: end');
      },
      _logout: function() {
        // console.log('_logout: start');
        this.$.semafloorAuth.logout();
        // console.log('_logout: end');
      },

      animateReservePage: function() {
        // console.log('animateReservePage: start');
        this.set('_animateReserve', !0);

        if (!this._isSearchPageOpened) {
          this.set('_isSearchPageOpened', !0);
        }else {
          this.$$('#searchPage').classList.add('animate-reserve');
          window.location.hash = '#search/view';
        }
        // console.log('animateReservePage: end');
      },

      // Set _categories and _categoryNames with hash change.
      _recategorize: function(_ifTrueSetNewElseReset) {
        // console.log('6 - _recategorize: start');
        var _newCategoryNames = [ 'Home', 'Current Reservations', 'Room Information' ];
        var _newCategories = [ 'home', 'current', 'room' ];
        if (_ifTrueSetNewElseReset) {
          _newCategoryNames = [ 'Home', 'My Profile', 'My Reservations',
          'Search & Reserve', 'Current Reservations', 'Room Information'];
          _newCategories = [ 'home', 'profile', 'reserve', 'search', 'current', 'room' ];
        }

        this.set('_categoryNames', _newCategoryNames);
        this.set('_categories', _newCategories);
        // console.log('6 - _recategorize: end');
      },
      // Rename page title with hash change.
      _rePageTitle: function(_categoryFromHash) {
        // console.log('9 - _rePageTitle: start');
        var _pageIdx = this._categories.indexOf(_categoryFromHash);
        var _pageTitle = this._categoryNames[_pageIdx];
        this.set('pageTitle', _pageTitle);
        // console.log('9 - _rePageTitle: end');
      },

      // Awaiting v0.0.15 release of app-layout
      _onDrawerClosed: function(ev) {
        // console.log(ev);
      },
      // workaround: Since drawer is not present on large screen, should close it
      // when it is remained open small screen if landscape mode considers a large screen.
      _closeDrawerOnLargeScreen: function(_smallScreen) {
        if (!_smallScreen) {
          this.debounce('_closeDrawerOnLargeScreen', function() {
            this.$.drawer.close();
          });
        }
      },

      // TODO: Support Shadow DOM
      // TODO: dialog not able to be opened on profile page.
      // TODO: iron-image inside dom-if not able to have round edges on Shadow DOM.
      // TODO: Rever all changes in room page now caused a lot of janks.
      // X - TODO: Fixed search page's search result when dialog is closed. Eg. floor level is not cleared.
      // X - TODO: Using slimmed down version of _checkIfUserExists(authUser), check _updateUid(authUser).
      // X - TODO: Better hash strategy, header's resetLayout > _hashDidChange > category.
      // X - TODO: Redirect to home page if hash is empty.
      // X - TODO: Reserve page dialog not working properly, always shows under backdrop, caused by will-change: opacity;
      // X - TODO: Modify pathname by appending user's name while logged in.
      // X - TODO: Close drawer on large screen if the drawer is remained open when transitioning from small to large.
      // X - TODO: Add user name and user image on large screen as well as able to sign in and out at large screen.
      // X - TODO: No longer double tabs in a page. No more disaster! Just like google search, today, thisweek and upcoming all show in one page and show horizontally if screen size is large enough.
      // X - TODO: Current page needs a new height, maybe use customProp to resolve it.
      // TODO: Fix all spinner on all pages (skip search-page, done: room, current, profile, containerised: room, profile).
      // TODO: Add Semafloor logo maybe?
      // TODO: Awaiting Polymer to support native customProp (tabs' selection bar needs polyfill).
      // TODO: To remove all will-change: opacity that will cause dialog to fall behind backdrop.
    });
  </script>
</dom-module>
